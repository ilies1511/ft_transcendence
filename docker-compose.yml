services:
  app2:
    build:
      context: .
      dockerfile: docker/Dockerfile.dev
    volumes:
      - ./:/app
      # - node_modules_FE:/app/core/frontend/node_modules
      # - node_modules_BE:/app/core/backend/node_modules
      # - node_modules_core:/app/core/node_modules
    working_dir: /app
    ports:
      - "3000:3000"
      - "3001:3001"
      - "5173:5173"
    stdin_open: true
    tty: true
    command: sh


  dev_maksim:
    build:
      context: .
      dockerfile: docker/dev_maksim.Dockerfile
    container_name: dev_maksim
    volumes:
      - ./:/app
    working_dir: /app/core
    tty: true
    stdin_open: true
    ports:
      - "3000:3000"
      - "3001:3001"
      - "5173:5173"


  dev_fabi:
    build:
      context: .
      dockerfile: docker/dev_fabi.Dockerfile
    container_name: dev_fabi
    tty: true
    volumes:
      - .:/home/$USER/app
      - .config/nvim:/home/$USER/.config/nvim
    environment:
      - WAYLAND_DISPLAY
      - XDG_RUNTIME_DIR
    ports:
      - "3000:3000"
      - "5173:5173"
  app:
    build:
      context: .
      dockerfile: docker/app.Dockerfile
    env_file:
      - .env.prod
    expose:
      - "3000"
    volumes:
      - sqlite_data:/app/core/backend/data
    restart: unless-stopped

  edge:
    build:
      context: .
      dockerfile: docker/Caddyfile.prod.Dockerfile
    ports:
      - "8080:80"
      - "1443:443"
    volumes:
      - ./docker/Caddyfile:/etc/caddy/Caddyfile:ro
    depends_on:
      - app
    restart: unless-stopped

volumes:
  sqlite_data:
